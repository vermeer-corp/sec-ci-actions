name: GitLeaks Secret Scan

runs:
  using: "composite"
  steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: "0"

    - name: Use Vermeer Definitions # forked from official repo with exceptions for false positives
      run: mkdir security-config; wget -P security-config/ https://raw.githubusercontent.com/vermeer-corp/gitleaks/master/config/gitleaks.toml
      shell: bash

    - name: Run GitLeaks Scan
      id: gitleaks
      uses: DariuszPorowski/github-action-gitleaks@v2
      with:
        config: security/gitleaks.toml
        
#     - name: Report no secrets found
#       if: ${{ github.event_name != 'pull_request' }}
#       uses: vermeer-corp/sec-ci-actions/secret-report@main
#       with:
#         found-secrets: false
#         repo-name: ${{ github.repository }}

#     - name: Report secrets found
#       if: ${{ failure() && github.event_name != 'pull_request' }}
#       uses: vermeer-corp/sec-ci-actions/secret-report@main
#       with:
#         found-secrets: true
#         repo-name: ${{ github.repository }}
